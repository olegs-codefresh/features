version: '1.0'

steps:
  launch:
    type: composition
    title: testing in composition
    composition: ./docker-compose.yaml
    on_success: # Execute only once the step succeeded
      metadata: # Declare the metadata attribute
        set: # Specify the set operation
          - ${{build_step.imageId}}: # Select any number of target images
            - qa: pending

    on_fail: # Execute only once the step failed
      metadata: # Declare the metadata attribute
        set: # Specify the set operation
          - ${{build_step.imageId}}: # Select any number of target images
            - exit_code: 1

    on_finish: # Execute in any case
      metadata: # Declare the metadata attribute
        set: # Specify the set operation
          - ${{build_step.imageId}}: # Select any number of target images
            - is_main:
                evaluate: "'${{CF_BRANCH}}' == 'main'"
