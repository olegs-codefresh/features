version: '1.0'

steps:
  launch:
    type: composition
    title: testing in composition
    composition: ./docker-compose.yaml
    composition_candidates:
      failed:
        image: containers101/demochat:test-failed
        command: 'gulp test'
    on_success: # Execute only once the step succeeded
      metadata: # Declare the metadata attribute
        set: # Specify the set operation
          - qa: pending

    on_fail: # Execute only once the step failed
      metadata: # Declare the metadata attribute
        set: # Specify the set operation
          - exit_code: 1

    on_finish: # Execute in any case
      metadata: # Declare the metadata attribute
        set: # Specify the set operation
          - is_main:
              evaluate: "'${{CF_BRANCH}}' == 'main'"
